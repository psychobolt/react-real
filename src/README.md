# Documentation

## Components

Common usage with [ReglContainer](#reglcontainer) and its default [renderer](#reglrenderer).

### ReglContainer

Creates a Regl context that is accessible through a [consumer](#contextconsumer). All children are rendered into a view (default: fullscreen canvas) with [ReglRenderer](#reglrenderer) by default.

> To prevent context loss, it is advised to have at most one container component. There is a [react-multi-regl](https://github.com/psychobolt/react-regl/blob/master/packages/react-multi-regl) package, if you wish to multiplex a regl instance across different views.

```jsx
import { ReglContainer } from '@psychobolt/react-regl';

import Scene from './Scene';

export default props => <ReglContainer {...props}><Scene /></ReglContainer>;
```

#### Props

##### ```renderer?: ReglRenderer```

The default is [ReglRenderer](#reglrenderer). Alternatively, you can [extend](#extension-example) and pass in your own.

##### ```types?: { [type: string]: (props: {}, context: ContextContainer ) => Object }```

If you prefer to not extend [ReglRenderer](#reglrenderer), another option is to provide a list of types similiar to the renderer's [default types](#defaulttypes--type-string-props--context-contextcontainer---object-).

##### ```viewProps?: {}```

Props to be passed to the view.

##### ```View?: React.ElementType | WebGLRenderingContext | Element```

If no view is provided, the [default view](http://regl.party/api#as-a-fullscreen-canvas) will be generated by regl.

##### ```contextProps?: {}```

Initialization [options](http://regl.party/api#initialization-options) for regl.

##### ```statsWidget?: boolean```

If the value is true, a widget appears on the top left corner of the view and displays the average render time for each [Drawable](#drawable). The stats widget requires you to have [styled-components](https://www.npmjs.com/package/styled-components)@4.1.x.

##### ```onMount?: (context: ContextContainer) => any```

Callback function to be called when the container has mounted. Receives API access to the [context container](#context-container).

### Context.Consumer

Allows API access to the current [context container](#context-container) object. Same API as React's [Context.Consumer](https://reactjs.org/docs/context.html#contextconsumer).

```jsx
import { Context } from '@psychobolt/react-regl';

import Scene from './Scene';

export default () => (
  <Context.Consumer>
    {({ context }) => <Scene context={context} />}
  </Context.Consumer>
);
```

### Collection

Allows mapping of a hierarchy similiar to the DOM tree. Provides a simple data structure, array, for connecting react-regl type instances. 

```jsx
import React from 'react';
import { Collection } from '@psychobolt/react-regl';

import { Object } from './Object';

export default () => <Collection><Object /></Collection>;
```

### Types

Following are collection types with specific roles.

#### Drawable

Regl's draw [command](http://regl.party/api#commands).

```jsx
import React from 'react'
import { Drawable } from '@psyhcobolt/react-regl';

import frag from './Triangle.frag';
import vert from './Triangle.vert';

const attributes = {
  position: [[0, -1], [-1, 0], [1, 1]]
};

export default () => (
  <Drawable frag={frag} vert={vert} attributes={attributes} count={3}>
    {/* children */}
  </Drawable>
);
```

##### Props

For full list of props, see regl's [documentation](http://regl.party/api#parameters). Following, are some additional control props.

###### ```name?: string```

Optional name for the draw command.

###### ```args?: {} | (context: ReglContext) => {}```

Arguments that are passed to the command on execution. You may use a function that accepts regl's [context](http://regl.party/api#context) variables to construct arguments.

###### ```render?: (args: {}) => void```

Instead of running a regl command, the render function is called in place.

###### ```scoped?: boolean```

If the value is true, during render, sub commands are executed in [scope](http://regl.party/api#scoped-commands).

#### Frame

Render children within regl's [frame](http://regl.party/api#per-frame-callbacks) callback.

```jsx
import React from 'react';
import { Frame } from '@psychobolt/react';

function onFrame({ regl }) {
  regl.clear({
    color: [0, 0, 0, 1],
    depth: 1,
  });
}

export default () => <Frame onFrame={onFrame}>{/* children */}</Frame>
```

##### Props

###### ```onFrame?: (context: ContextContainer & ReglContext) => any```

Callback that is invoked before any children is updated.

###### ```onUpdate?: (context: ContextContainer & ReglContext & { drawCallback }) => any```

Overrides the default frame update.

```jsx
function onUpdate({ draw, ...context)) {
  // Do your own work here
  draw({}); // drawCallback?: (args: {}) => void
}
```
### Framebuffer

A component helper to create and provide a [framebuffer](http://regl.party/api#framebuffers).

```jsx
import React from 'react';
import { Framebuffer } from '@psychobolt/react-regl';

export default ({ children, ...props }) => <Framebuffer {...props}>{fbo => children(fbo)}</Framebuffer>
```

#### Props

Inherits props from [Drawable](#drawable). Pass in any props that is taken by regl's framebuffer [constructor](http://regl.party/api#constructor-5).

##### ```children?: fbo => React.Node```

The framebuffer object can be accessed from the children prop function.

##### ```fitView?: boolean```

If true, the framebuffer will automatically be sized as viewport's width and height. Default is false.

### Cube

A component helper to create and provide a [cube map](http://regl.party/api#cube-maps).

```jsx
import React from 'react';
import { Cube } from '@psychobolt/react-paperjs';

import Scene from './Scene';
import images from './images';

export default () => <Cube images={images}>{cube => <Scene cube={cube} />}</Cube>;
```

#### Props

Inherits props from [Drawable](#drawable).

##### ```images?: Image[]```

A array of images for faces: positive X, negative X, positive Y, negative Y, positive Z, and negative Z. Providing this prop is equivilent to ```regl.cube(...images)```. Hence, other props besides ```args``` are ignored.

### Resource

Preload and provide resource objects. See API for [resl](https://github.com/regl-project/resl) for more details.

```jsx
import React from 'react';
import { Resource } from 'react';

import Scene from './Scene';
import video from './video.mp4'; // imported with webpack url loader plugin

const manifest = {
  video: {
    'type': 'video',
    stream: true,
    src: video, // a url string
  }
};

export default () => <Resource manifest={manifest}>{video => <Scene video={video} />}</Resource>;
```

##### Props

All props are passed to the constructor.

### Texture

Create and provide a regl [texture](http://regl.party/api#textures).

```jsx
import React from 'react';
import { Texture } from '@psychobolt/react';

import Scene from './Scene';
import image from './image.jpg';

export default () => <Texture source={image}>{texture => <Scene texture={texture} />}</Texture>;
```

#### Props

Inherits props from [Drawable](#drawable).

##### ```source?: | number[] | Image | CanvasRenderingContext2D | HTMLVideoElement```

A object that consist of the media. Providing this prop is equivilant to ```regl.texture(source)```. Hence, other props besides ```args``` are ignored.

## API

### Context Container

The context container is instantiated when [ReglContainer](#reglcontainer) is mounted. The context container provides access to the [collection](#collection), regl's instance, and view element.

```jsx
function callback(context) {
  const { regl, children, view } = context;
  // custom logic here
}
```

### ReglRenderer

Currently a synchronous but extensible implementation.

#### Members

##### ```defaultHostConfig: {}```

The host config that is passed into React Reconciler by default. __This should not be mutated__. Instead, extend ReglRenderer with a ```getHostConfig``` function.

##### ```defaultTypes: { [type: string]: (props: {}, context: ContextContainer ) => Object }```

A mapping of types with their instance factory method. ___This should not be mutated___. Instead, extend ReglRenderer with a getHostConfig function.

#### Extension Example

```jsx
import React from 'react';
import { ReglContainer, ReglRenderer } from '@psychobolt/react-regl';

import MyCustomType, { CONSTANTS, Types } from './types'

class MyReglRenderer extends ReglRenderer {
  getInstanceFactory() {
    return {
      ...super.getInstanceFactory(),
      [CONSTANTS.MyCustomType]: (props, context) => new Types.MyCustomType(props, context),
    };
  }
}

export default props => (
  <ReglContainer {...props} renderer={MyReglRenderer}>
    <MyCustomType />
  </ReglContainer>
);
```

The above code adds a custom Component Type to the renderer's instance factory. Then the component can be rendered inside the container.